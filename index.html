<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axel PFP Generator</title>
    <style>
        body {
            font-family: 'Pixelated MS Sans Serif', Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-image: linear-gradient(to bottom, #f9daf3, #f7cdee, #f5bfe8, #f4b2e2, #f2a4dc);
            background-color: #000;
        }

        #background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
        }
        .blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(15px) grayscale(50%);
            z-index: -1;
        }
        .window {
            width: 700px;
            padding-top: .5rem;
            padding-bottom: .5rem;
            background-image: linear-gradient(to top, #f5bfe8, #f4b2e2, #f2a4dc);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        @media (max-width: 600px) {
    body {
        flex-direction: column;
        padding: 1rem;
        align-items: flex-start; /* Change from center to prevent any stretching */
        height: auto; /* Remove full viewport height */
    }
    .window {
        width: 95%;
        background-color: transparent;
    }
    #canvas-container {
        width: 100%;
        max-width: 85vw; /* Ensure container doesn't get too big */
        height: auto; /* Let the height adapt to the content naturally */
        margin-top: 0px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #canvas {
        width: 100%;
        max-width: 85vw; /* Ensure container doesn't get too big */
        height: 85vw; /* Match the height with width to maintain aspect ratio */
        object-fit: contain; /* Ensure image maintains its aspect ratio */
        border: none;
    }
    #customUploadBtn, #downloadBtn {
        font-size: 14px;
        padding: 4px 8px;
    }
    .title-bar-text h1 {
        font-size: 30px; /* Make the title smaller for mobile */
    }
    .title-bar-text p {
        font-size: 20px; /* Adjust the paragraph text */
    }
    #overlay-bar {
        width: 100%;
        padding: 5px; /* Reduce padding to fit on mobile */
    }
    .overlay-preview img {
        width: 60px; /* Reduce image sizes */
        height: 60px;
    }
}
        .title-bar {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .title-bar-text h1 {
            font-family: "East Sea Dokdo", sans-serif;
            font-weight: bold;
            color: white;
            letter-spacing: 0;
            font-size: 45px;
            text-shadow: #000000 2px 2px;
            margin: 0;
        }
        .title-bar-text p {
            font-family: "East Sea Dokdo", sans-serif;
            color: white;
            font-size: 26px;
            text-shadow: #000000 .8px .8px;
            margin: 0;
        }
        #canvas-container {
            width: 600px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px;
        }
        #canvas {
            border: 1px dotted #ff8ae6;
        }
/* For WebKit browsers (Chrome, Safari, etc.) */
#overlay-bar::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}
#overlay-bar::-webkit-scrollbar-track {
    background: #f097db; /* Light purple background */
    border-radius: 10px;
}
#overlay-bar::-webkit-scrollbar-thumb {
    background-color: #fc2ecf; /* Darker purple scrollbar thumb */
    border-radius: 10px;
}
#overlay-bar::-webkit-scrollbar-thumb:hover {
    background-color: #fc2ecf; /* Darker shade on hover */
}
/* For Firefox */
#overlay-bar {
    scrollbar-width: thin;
    scrollbar-color: #fc2ecf #f097db; /* Scrollbar thumb and track */
    
}
/* For Edge, Internet Explorer, and others */
#overlay-bar {
    -ms-overflow-style: none; /* Hides default scrollbar */
}
#overlay-bar {
    display: flex;
    justify-content: flex-start;  /* Aligns items to the start of the bar */
    overflow-x: auto;
    width: 95%;
    margin-top: 20px;
    padding-left: 0;  /* Remove padding to prevent cutting off the first item */
    padding-right: 0;
    gap: 5px; /* Smaller spacing between items */
}
        .overlay-preview {
            flex: 0 0 auto;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .overlay-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }
        .overlay-preview:hover {
            border-color: #ff8ae6;
        }
        #downloadBtn {
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            padding: 10px 20px;
            background-color: #ff8ae6;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        #downloadBtn:hover {
            background-color: #f097db;
        }
        .window-body {
            margin: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .field-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
        }
        .field-row label {
            margin-bottom: 10px;
        }
        #imageUpload {
            padding: 10px;
            background-color: #ff8ae6;
            border: 1px solid #ff8ae6;
            border-radius: 5px;
        }
        #customUploadBtn {
    display: inline-block;
    padding: 10px 20px;
    background-color: #ff8ae6;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-size: 16px;
    text-align: center;
}
#customUploadBtn:hover {
    background-color: #f097db;
}
    </style>
</head>
<body>
    <div class="blur-overlay"></div>
    <video id="background-video" autoplay muted loop>
        <source src="bg.webm" type="video/webm">
        Your browser does not support the video tag.
    </video>
    <div class="window">
        <div class="title-bar">
            <div class="title-bar-text">
                <h1>Axel-otl yourself!</h1>
                <br>
                <p>Upload your Profile Picture, Choose an overlay, and click "Download Profile Picture"</p>
            </div>
        </div>
        <div class="window-body">
            <div id="canvas-container">
                <canvas id="canvas" width="600" height="600"></canvas>
            </div>
            <div class="field-row">
                <label for="imageUpload"  id="customUploadBtn">Upload, Paste or Drag your Profile Picture</label>
                <input type="file" id="imageUpload" accept="image/*"style="display: none;">
            </div>
            <div id="overlay-bar">
                <div class="overlay-preview" data-overlay="0">
                    <img src="overlayaxel.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="1">
                    <img src="overlayaxel2.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="2">
                    <img src="overlayaxel3.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="3">
                    <img src="overlayaxel4.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="4">
                    <img src="overlayaxel5.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="5">
                    <img src="overlayaxel.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="1">
                    <img src="overlayaxel2.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="2">
                    <img src="overlayaxel3.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="3">
                    <img src="overlayaxel4.png" alt="" class="overlay-icon">
                </div>
                <div class="overlay-preview" data-overlay="4">
                    <img src="overlayaxel5.png" alt="" class="overlay-icon">
                </div>
            </div>
            <button id="downloadBtn">Download Profile Picture</button>
        </div>
    </div>
    <div style="margin-top: 20px; position: absolute; bottom: 10px;">
        <button style="display: none;" onclick="goBack()" class="btn">Go Back</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <script>
        function goBack() {
            window.history.back();
        }
    
        const canvas = new fabric.Canvas('canvas', { width: 600, height: 600 });
        const imageUpload = document.getElementById('imageUpload');
        const downloadBtn = document.getElementById('downloadBtn');
    
        const overlays = [
            'overlayaxel.png',
            'overlayaxel2.png',
            'overlayaxel3.png',
            'overlayaxel4.png',
            'overlayaxel5.png'
        ];
    
        let currentOverlay = null;
    
        // Handle Overlay Selection from Scrollable Bar
        document.querySelectorAll('.overlay-preview').forEach(preview => {
            preview.addEventListener('click', (e) => {
                const selectedOverlay = preview.getAttribute('data-overlay');
                if (selectedOverlay !== '') {
                    setOverlayImage(overlays[selectedOverlay]);
                }
            });
        });
    
        function setOverlayImage(url) {
            // Remove the existing overlay if there is one
            if (currentOverlay) {
                canvas.remove(currentOverlay);
            }
    
            fabric.Image.fromURL(url, (img) => {
                img.scaleToWidth(canvas.width);
                img.scaleToHeight(canvas.height);
                img.set({
                    left: canvas.width / 2,
                    top: canvas.height / 2,
                    originX: 'center',
                    originY: 'center'
                });
                canvas.add(img);
                currentOverlay = img; // Store reference to the current overlay
                canvas.renderAll();
            }, { crossOrigin: 'anonymous' });
        }
    
        // Handle Image Upload via file input
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    fabric.Image.fromURL(event.target.result, (img) => {
                        img.scaleToWidth(canvas.width);
                        img.scaleToHeight(canvas.height);
                        img.set({
                            left: canvas.width / 2,
                            top: canvas.height / 2,
                            originX: 'center',
                            originY: 'center'
                        });
                        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                            crossOrigin: 'anonymous'
                        });
                    });
                };
                reader.readAsDataURL(file);
            }
        });
    
        // Handle Drag-and-Drop Image Upload
        const canvasContainer = document.getElementById('canvas-container');
        canvasContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
        });
    
        canvasContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    fabric.Image.fromURL(event.target.result, (img) => {
                        img.scaleToWidth(canvas.width);
                        img.scaleToHeight(canvas.height);
                        img.set({
                            left: canvas.width / 2,
                            top: canvas.height / 2,
                            originX: 'center',
                            originY: 'center'
                        });
                        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                            crossOrigin: 'anonymous'
                        });
                    });
                };
                reader.readAsDataURL(file);
            }
        });
    
        // Handle Paste Image Upload
        window.addEventListener('paste', (e) => {
            const items = e.clipboardData.items;
            for (const item of items) {
                if (item.type.startsWith('image/')) {
                    const file = item.getAsFile();
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        fabric.Image.fromURL(event.target.result, (img) => {
                            img.scaleToWidth(canvas.width);
                            img.scaleToHeight(canvas.height);
                            img.set({
                                left: canvas.width / 2,
                                top: canvas.height / 2,
                                originX: 'center',
                                originY: 'center'
                            });
                            canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                                crossOrigin: 'anonymous'
                            });
                        });
                    };
                    reader.readAsDataURL(file);
                }
            }
        });
    
        downloadBtn.addEventListener('click', () => {
            const canvasElement = canvas.getElement();
            const originalBorder = canvasElement.style.border;
            canvasElement.style.border = 'none';
    
            canvas.discardActiveObject();
            canvas.renderAll();
    
            canvasElement.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'profile_picture.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
    
                canvasElement.style.border = originalBorder;
                canvas.renderAll();
            });
        });
    </script>
    
</body>
</html>
